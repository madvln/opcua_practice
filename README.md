# Проект: Модель бойлера с OPC UA сервером и историей

## Описание

Проект моделирует бойлер с двумя входными потоками (горячая и холодная вода) и одним выходным потоком. Управление осуществляется через регулируемые клапаны на входах и выходе.

- **boiler_model.py** — модель бойлера (логика изменения уровня и температуры)
- **opc_server.py** — OPC UA сервер, который предоставляет данные модели и принимает команды (открытие клапанов)
- **server_main.py** — запускает модель и сервер, обновляет состояние каждую секунду
- **opcua_client.py** — пример клиента, который читает данные с OPC UA сервера (например, SCADA-интерфейс)
- **history_logger.py** — отдельный процесс, который раз в 5 секунд считывает данные с OPC UA сервера и записывает в SQLite базу

---

## Начальные условия модели

- Бойлер пустой (0% заполнения)
- Клапаны на горячем и холодном входе открыты на 50%
- Клапан на выходе открыт на 100%
- Температура горячей воды — 90°C, холодной — 10°C

---

## Как запустить

1. Установить зависимости (например, opcua):
   ```bash
   pip install opcua
   ```

2. Запустить OPC UA сервер и модель бойлера:

   ```bash
   python server_main.py
   ```

3. В другом терминале запустить логирование истории:

   ```bash
   python history_logger.py
   ```

4. Для теста или мониторинга можно запустить клиент:

   ```bash
   python opcua_client.py
   ```

   ---

## Как это работает

* `run_server.py` запускает OPC UA сервер.
* `run_model.py` создаёт экземпляр модели и передает значения в OPC UA сервер.
* Каждую секунду модель обновляет уровень и температуру, учитывая текущие положения клапанов.
* OPC UA сервер публикует переменные:

  * Температуры входящих потоков (фиксированные)
  * Положения клапанов (управляемые)
  * Температура на выходе и уровень воды в бойлере
* `history_logger.py` подключается к серверу, считывает эти переменные и записывает их в базу данных для последующего анализа.
* `app.py` запускает SCADA, где пользователь может читать значения и управлять клапанами. Или пользователи могут подключиться к OPC UA серверу через клиент `viewer.py`

---

## Что можно добавить дальше

* Веб-интерфейс (Flask) для визуализации данных и управления клапанами
* Автоматический регулятор (ПИД) для поддержания уровня и температуры
* Экспорт истории в CSV
* Графики в реальном времени

---


## [OPC DA (Data access)](/docs/opc_da.md)

## [Стандарт OPC UA](/docs/opc_ua.md)

