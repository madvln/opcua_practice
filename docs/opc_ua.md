# Стандарт OPC UA

## Что такое OPC UA и для чего его разработали?

Самое широкое распространение получил стандарт OPC DA, но у него есть существенный недостаток. Во времена его разработки он был построен на современных Windows-технологиях: OLE, ActiveX, COM/DCOM, но с тех пор в отрасли прошли изменения и большое распространение получили другие ОС и технологии. Поэтому технологию OPC сделали платформонезависимой и разработали стандарт OPC UA (Unified Architecture) на открытых кроссплатформенных технологиях.

> **OPC UA (Unified Architecture)** — последняя по времени выпуска спецификация, которая основана не на технологии Microsoft COM, что предоставляет кроссплатформенную совместимость.

---

## Преимущества OPC UA  

### **1. Кроссплатформенность и независимость от ОС**  
- Работает на Windows, Linux, macOS и даже встраиваемых системах.  
- Поддержка Docker и облачных решений (Azure, AWS).  

### **2. Встроенная безопасность**  
- Шифрование данных (TLS/SSL, AES-256).  
- Аутентификация (сертификаты X.509, OAuth 2.0).  
- Гибкие политики доступа (роли пользователей, RBAC).  

### **3. Единая модель данных**  
- Объектно-ориентированная архитектура (можно описывать сложные структуры: устройства, датчики, процессы).  
- Информационные модели (например, Companion Specifications для Industrie 4.0, PackML, FDI).  
- Поддержка метаданных (единицы измерения, описание параметров).  

### **4. Разнообразие транспортных протоколов**  
- OPC UA over TCP (бинарный протокол для высокой производительности).  
- HTTP/SOAP (для веб-интеграции).  
- PubSub over MQTT/UDP (для IoT и промышленного IoT).  

### **5. Надежность и отказоустойчивость**  
- Встроенные механизмы реконнекта и буферизации данных при обрывах связи.  
- Поддержка исторических данных (HA — High Availability).  
- Режимы реального времени (подписки с низкими задержками).  

### **6. Масштабируемость**  
- От встраиваемых устройств (например, Raspberry Pi) до облачных платформ.  
- Поддержка горизонтального масштабирования (кластеризация серверов).  

### **7. Открытость и стандартизация**  
- Не зависит от вендоров (разрабатывается OPC Foundation).  
- Бесплатные open-source SDK (например, open62541).  
- Совместимость с IIoT (Industrial Internet of Things) и Industry 4.0.  

### **8. Универсальность**  
- Замена множества протоколов (OPC DA, Modbus, SNMP) единым стандартом.  
- Поддержка не только данных, но и событий, команд, алармов.  

### **Сравнение с OPC DA**  
| Характеристика       | OPC UA                          | OPC DA                     |  
|----------------------|---------------------------------|----------------------------|  
| **Платформа**        | Кроссплатформенный             | Только Windows             |  
| **Безопасность**     | TLS, сертификаты               | Нет (DCOM уязвим)          |  
| **Модель данных**    | Объектно-ориентированная       | Плоская (только теги)      |  
| **Сеть**             | Работает через NAT/брандмауэр  | Проблемы с DCOM            |  
| **Реальное время**   | Оптимизированные подписки      | Быстрее, но небезопасно    |  

---

> Таким образом, OPC UA обеспечивает защищенную и надежную коммуникацию между устройствами, являясь при этом аппаратно- и платформо-независимым, что позволяет обеспечить обмен данными между устройствами с разными операционными системами.

---

## Недостатки OPC UA  

### **1. Сложность внедрения**  
- Высокий порог входа: OPC UA сложнее в настройке по сравнению с классическим OPC DA из-за своей многокомпонентной архитектуры.  
- Требует квалификации: для работы нужны специалисты, разбирающиеся в безопасности, сертификатах и сетевых настройках.  

### **2. Производительность**  
- Низкая скорость в реальном времени: по сравнению с OPC DA или специализированными протоколами (например, EtherCAT, PROFINET) OPC UA может быть менее эффективен для высокочастотных данных.  
- Накладные расходы: использование XML или бинарного кодирования (UA Binary) добавляет задержки, особенно при передаче больших объемов данных.  

### **3. Безопасность и сертификаты**  
- Сложность управления PKI: механизм сертификатов (X.509) требует настройки и поддержки, что усложняет развертывание.  
- Проблемы с межсетевым взаимодействием: брандмауэры и NAT могут блокировать соединения OPC UA, требуя дополнительной настройки.  

### **4. Ограниченная поддержка legacy-систем**  
- Совместимость со старым OPC DA: требуются шлюзы (например, OPC UA Proxy), что добавляет точку отказа.  
- Не все устройства поддерживают OPC UA: многие промышленные устройства до сих пор работают только с OPC DA или Modbus.  

### **5. Ресурсоемкость**  
- Высокие требования к системе: серверы OPC UA, особенно с историей данных или сложными информационными моделями, требуют мощных CPU и памяти.  
- Большой трафик: подписки на события и мониторинг данных могут создавать нагрузку на сеть.  

### **6. Стандартизация и совместимость**  
- Не все реализации одинаковы: разные вендоры могут по-своему интерпретировать стандарт, что приводит к проблемам совместимости.  
- Отсутствие единого профиля: например, PubSub over MQTT и PubSub over UDP реализованы по-разному у разных производителей.  

### **7. Лицензирование и стоимость**  
- Платные SDK: некоторые коммерческие библиотеки для разработки OPC UA-серверов/клиентов требуют лицензий.  
- Стоимость инфраструктуры: внедрение PKI, HA-кластеров и резервирование увеличивают бюджет проекта.  

> Итак, OPC UA — это современный, безопасный и гибкий стандарт, но его использование оправдано не во всех сценариях. Для высокоскоростных систем реального времени или устаревших устройств могут потребоваться дополнительные решения (например, OPC DA + шлюз или специализированные промышленные протоколы).  

## Принцип работы  

Вместо дерева тегов, теперь вводится понятие узлов или объектов. Каждый узел включает в себя переменные, методы и другие структуры данных реального объекта.

![Схема работы OPC UA](https://ipc2u.ru/upload/medialibrary/b6e/xim2.png.pagespeed.ic.nsbvcIQPOW.webp "Структура OPC UA")

![Схемы работы стека связи OPC UA](https://ipc2u.ru/upload/medialibrary/4a8/xim3.png.pagespeed.ic.uo59EJPB34.webp "Стек связи OPC UA")

Обмен данными теперь происходит через бинарные структуры и XML документы. В дополнение к модели клиент/сервер становится доступна модель издатель/подписчик. Также стандарт определяет механизм для поддержки резервирования (если один клиент станет не доступным, то его заменит другой) и быстрого восстановления связи в случае сбоя. Передача данных происходит через транспортный слой TCP, HTTP/SOAP или HTTPS. Вместо механизмов контроля прав доступа Windows, в OPC UA реализована поддержка цифровых сертификатов и возможность шифрования передаваемых данных.

Реализована обратная совместимость с OPC DA через специальную оболочку (wrapper) и proxy-модуль. Для передачи данных через маршрутизаторы и межсетевые экраны OPC DA требовал использовать промежуточное ПО, OPC UA же работает без прослойки. Спецификация OPC UA включает в себя несколько частей, которые описывают логику работы серверов и клиентов. Детальная версия спецификации доступна в стандарте IEC 62541.

---

## OPC UA для работы в реальном времени

OPC UA over TSN - для поддержки работы в реальном времени технология OPC UA (вместо модели клиент/сервер) может использовать модель издатель/подписчик совместно с технологией TSN (Time-Sensitive Networking).

Модель клиент/сервер хорошо работает в случае подключения точка-точка, но если устройств становится много, то появляются задержки в обновлении данных. Модель издатель/подписчик обеспечивает связь от одного ко многим и от многих ко многим. Сервер отправляет свои данные в сеть (публикация) и каждый клиент может получить эти данные (подписка).

![Сравнение моделей Клиент-Сервер и Издатель-Подписчик стека связи OPC UA](https://ipc2u.ru/upload/medialibrary/38c/xim4.png.pagespeed.ic.BJ1XfRoyyo.webp "Сравнение моделей стека связи OPC UA")

Технология Ethernet с TSN дополняет существующие средства Ethernet в том, что касается обеспечения качества обслуживания трафика (QoS), включая выделение полосы пропускания, синхронизацию, гарантию низких значений задержки и обеспечения резервирования. Данные, которые передают различные устройства по Ethernet сети, представляют собой потоки. Ethernet коммутаторы с TSN позволяют выделить для каждого потока свою полосу пропускания и обеспечить его передачу в реальном времени. Несколько потоков можно объединить (это называется сетевой конвергенцией) и организовать их передачу по одной сети в режиме реального времени. Получается без технологии TSN по одной Ethernet сети можно передавать только один протокол реального времени, а с TSN несколько.

Объединение технологий OPC UA over TSN позволяет организовать коммуникацию между оборудованием от разных производителей и гарантировать непрерывное получение данных в режиме реального времени.

OPC Foundation планирует использовать OPC UA не только для передачи данных между контроллерами и SCADA системой, но и на полевом уровне от датчиков и IoT устройств к контроллерам, а также от локальных систем в Облако. Для этого планируют разбить стандарт OPC UA на 4 части в зависимости от производительности устройства и необходимых ему возможностей.

- **Nano Embedded Device Server**: подходит для самых маленьких датчиков;
- **Micro Embedded Device Server**: подходит для недорогих ПЛК;
- **Embedded UA Server**: подходит для более мощных ПЛК и пограничных шлюзов;
- **Standard UA Server**: полноценная реализация, поддерживающая все функции.

![Схема работы технологии Ethernet over TSN](https://ipc2u.ru/upload/medialibrary/48b/xim5.png.pagespeed.ic.tNExEC0Lbl.webp "Схема работы технологии Ethernet over TSN")

---

## Перспективы стандарта OPC UA

Можно с уверенностью сказать, что, хотя стандарт OPC DA все еще широко применяется, но уже не удовлетворяет современным требованиям автоматизации. Он основан на устаревших технологиях, сложен в настройке и не соответствует современным стандартам безопасности. На смену ему пришел современный стандарт OPC UA с возможностью шифрования данных и построения единых систем передачи данных от датчиков до Облака. Совместное использование OPC UA с TSN позволяет значительно расширить возможности технологии для передачи данных в реальном времени. Конечно не стоит сейчас же бежать и избавляться от OPC DA, но можно постепенно модернизировать существующие системы и переходить на OPC UA через специальные оболочки (wrapper) и proxy-модули.

## [Теги в OPC](/docs/opc_tags.md)